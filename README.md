# AWS Fault Injection Service

## Du Plan de Reprise d‚ÄôActivit√© √† l‚Äôexp√©rimentation du Chaos

Impl√©menter AWS FIS pour valider la r√©silience dans le Cloud. Ce d√©p√¥t fournit un exemple de template FIS, un dashboard CloudWatch et des alarmes pour arr√™ter l'exp√©rience si des seuils critiques sont atteints.

## üß≠ Introduction

| üá´üá∑ Fran√ßais                                                                                                                                                                                                                                                                                                                                      | üá¨üáß English                                                                                                                                                                                                                                                                                                                           |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Du Plan de Reprise d‚ÄôActivit√© √† l‚Äôexp√©rimentation du Chaos<br>Ce d√©p√¥t montre comment utiliser AWS FIS pour valider la r√©silience d‚Äôune architecture Cloud. Il fournit un exemple de template FIS, un dashboard CloudWatch et des alarmes pour stopper l‚Äôexp√©rience si des seuils critiques sont atteints. | From Disaster Recovery Planning to Chaos Engineering<br>This repository demonstrates how to use AWS FIS to validate the resilience of a Cloud architecture. It provides an example FIS template, a CloudWatch dashboard, and alarms to stop the experiment if critical thresholds are reached. |


## üéØ But / Purpose

| üá´üá∑ Fran√ßais                                                                                                                                                                                                                                                     | üá¨üáß English                                                                                                                                                                                                                         |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| - Exemple de template AWS FIS pour tester la r√©silience : terminer une instance EC2 d‚Äôun ASG et injecter de la latence I/O sur les volumes EBS.<br>- Fournit √©galement un dashboard CloudWatch et des alarmes (certaines alarmes EBS sont comment√©es par d√©faut). | - Example of an AWS FIS template to test resilience: terminate an EC2 instance in an ASG and inject I/O latency on EBS volumes.<br>- Also provides a CloudWatch dashboard and alarms (some EBS alarms are commented out by default). |


## ‚öôÔ∏è Pr√©requis / Prerequisites

| üá´üá∑ Fran√ßais                                                                                                                                                                                                                                             | üá¨üáß English                                                                                                                                                                                                                                                |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| - Terraform (>= 1.0)<br>- AWS CLI configur√© (credentials / profile) ou variables d'environnement `AWS_ACCESS_KEY_ID` / `AWS_SECRET_ACCESS_KEY`<br>- Compte AWS avec droits suffisants pour cr√©er IAM, EC2, CloudWatch, FIS, S3, RDS, ALB, CloudWatch Logs | - Terraform (>= 1.0)<br>- Configured AWS CLI (credentials / profile) or environment variables `AWS_ACCESS_KEY_ID` / `AWS_SECRET_ACCESS_KEY`<br>- AWS account with sufficient permissions to create IAM, EC2, CloudWatch, FIS, S3, RDS, ALB, CloudWatch Logs |

### üóÇÔ∏è Ce qui est d√©ploy√© / Deployed Resources

| üá´üá∑ Fran√ßais                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | üá¨üáß English                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Fichiers principaux :**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | **Main files:**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| - `fis.tf`<br>  - `aws_fis_experiment_template.web_instance_failure` : template FIS principal<br>    - targets : `WebInstances` (instances tagg√©es `Service=web`), `Volumes-Target-azA` et `Volumes-Target-azB` (volumes EBS filtr√©s par zone/tags)<br>    - actions : `TerminateInstance` (terminer une instance) et `Volume_IO_Latency_*` (injecter latence I/O sur volumes EBS)<br>    - stop_conditions : r√©f√©rences vers alarmes CloudWatch (ALB, RDS, et possibilit√© d‚Äôalarmes EBS)<br>    - configuration de rapport d‚Äôexp√©rience (S3) et logs CloudWatch | - `fis.tf`<br>  - `aws_fis_experiment_template.web_instance_failure`: main FIS template<br>    - targets: `WebInstances` (instances tagged `Service=web`), `Volumes-Target-azA` and `Volumes-Target-azB` (EBS volumes filtered by zone/tags)<br>    - actions: `TerminateInstance` (terminate an instance) and `Volume_IO_Latency_*` (inject I/O latency on EBS volumes)<br>    - stop_conditions: references CloudWatch alarms (ALB, RDS, optional EBS alarms)<br>    - experiment reporting (S3) and CloudWatch logs |
| - `cloudwatch.tf`<br>  - `aws_cloudwatch_dashboard.fis_dashboard` : dashboard CloudWatch pour le monitoring FIS<br>  - alarmes : `aws_cloudwatch_metric_alarm.alb_5xx_alarm`, `alb_latency_alarm`, `rds_connections_alarm`<br>  - (optionnel/comment√©) alarmes EBS pour latence read/write (cr√©√©es par `for_each` sur les volumes)                                                                                                                                                                                                                               | - `cloudwatch.tf`<br>  - `aws_cloudwatch_dashboard.fis_dashboard`: CloudWatch dashboard for FIS monitoring<br>  - alarms: `aws_cloudwatch_metric_alarm.alb_5xx_alarm`, `alb_latency_alarm`, `rds_connections_alarm`<br>  - (optional/commented) EBS read/write latency alarms (created using `for_each` on volumes)                                                                                                                                                                                                    |
| - `main.tf`<br>  - VPC, subnets, security groups, ALB (`aws_lb.web_alb`), target group (`aws_lb_target_group.web_tg`), launch template (`aws_launch_template.web_lt`) et autoscaling group (`aws_autoscaling_group.web_asg`)                                                                                                                                                                                                                                                                                                                                     | - `main.tf`<br>  - VPC, subnets, security groups, ALB (`aws_lb.web_alb`), target group (`aws_lb_target_group.web_tg`), launch template (`aws_launch_template.web_lt`) and autoscaling group (`aws_autoscaling_group.web_asg`)                                                                                                                                                                                                                                                                                          |
| - `iam.tf`<br>  - r√¥le IAM pour FIS (`aws_iam_role.fis_experiment_role`) et policies requises                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | - `iam.tf`<br>  - IAM role for FIS (`aws_iam_role.fis_experiment_role`) and required policies                                                                                                                                                                                                                                                                                                                                                                                                                          |
| - `keypair.tf`, `provider.tf`, `local.tf`, `data.tf`, `output.tf` : configuration AWS, donn√©es (AMIs, volumes‚Ä¶), outputs et variables locales                                                                                                                                                                                                                                                                                                                                                                                                                    | - `keypair.tf`, `provider.tf`, `local.tf`, `data.tf`, `output.tf`: AWS configuration, data (AMIs, volumes‚Ä¶), outputs and local variables                                                                                                                                                                                                                                                                                                                                                                               |
| - `userdata.sh` : script d‚Äôinit pour les instances                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | - `userdata.sh`: initialization script for instances                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| - `fis_subnet.tf`, `fis_ecs.tf.exemple` : exemples et snippets suppl√©mentaires pour cibler des sous-r√©seaux ou ECS                                                                                                                                                                                                                                                                                                                                                                                                                                               | - `fis_subnet.tf`, `fis_ecs.tf.exemple`: examples and snippets to target subnets or ECS                                                                                                                                                                                                                                                                                                                                                                                                                                |
| - `errored.tfstate`, `log/`, `results/` : fichiers d‚Äô√©tat et donn√©es de sortie (logs, r√©sultats)                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | - `errored.tfstate`, `log/`, `results/`: state files and output data (logs, results)                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **Remarque :** certaines ressources (ex. volumes EBS via `data.aws_ebs_volumes`) sont attendues par les alarmes EBS/commentaires. Adaptez ou fournissez les data sources si n√©cessaire.                                                                                                                                                                                                                                                                                                                                                                          | **Note:** some resources (e.g., EBS volumes via `data.aws_ebs_volumes`) are expected by EBS alarms/comments. Adjust or provide data sources if necessary.                                                                                                                                                                                                                                                                                                                                                              |


## üóÇÔ∏è Arborescence du d√©p√¥t / Repository Structure

| üá´üá∑ Fran√ßais                                        | üá¨üáß English                          |
| ---------------------------------------------------- | ------------------------------------- |
| Arbre simplifi√© des fichiers √† la racine du projet : | Simplified file tree at project root: |

```text
.git/
.gitignore
README.md
cloudwatch.tf
data.tf
errored.tfstate
fis.tf
fis_ecs.tf.exemple
fis_subnet.tf
iam.tf
keypair.tf
local.tf
main.tf
output.tf
provider.tf
userdata.sh
```

### ‚ö†Ô∏è Points d‚Äôattention - Actions manuelles possible / Warnings - Manual Actions

| üá´üá∑ Fran√ßais                                                                                                                                                                                                                                                                                                                                                                                                                          | üá¨üáß English                                                                                                                                                                                                                                                                                                                                                                                              |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Alarmes EBS :**<br>- Les alarmes EBS sont comment√©es dans `cloudwatch.tf`. Si vous souhaitez que les `stop_conditions` dynamiques dans `fis.tf` soient valides, d√©commentez les ressources `aws_cloudwatch_metric_alarm` (ebs_read_latency_alarm / ebs_write_latency_alarm) et ex√©cutez `terraform apply`.<br>- Alternative : si vous ne voulez pas cr√©er ces alarmes, supprimez les blocs `dynamic "stop_condition"` dans `fis.tf`. | **EBS Alarms:**<br>- EBS alarms are commented in `cloudwatch.tf`. If you want dynamic `stop_conditions` in `fis.tf` to be valid, uncomment the `aws_cloudwatch_metric_alarm` resources (ebs_read_latency_alarm / ebs_write_latency_alarm) and run `terraform apply`.<br>- Alternative: if you don‚Äôt want to create these alarms, remove the `dynamic "stop_condition"` blocks in `fis.tf`.                |
| **Permissions pour le r√¥le FIS :**<br>- L‚Äôaction `aws:ebs:volume-io-latency` n√©cessite des permissions SSM/EC2. Assurez-vous que `aws_iam_role.fis_experiment_role` a les permissions n√©cessaires (ex. `ec2:Describe*`, `ec2:AttachVolume`, `ec2:DetachVolume`, `ssm:SendCommand`, `iam:PassRole`). Pour test rapide, attachez les policies manag√©es `AmazonEC2FullAccess` et `AmazonSSMFullAccess` (√† restreindre ensuite).           | **Permissions for FIS Role:**<br>- The action `aws:ebs:volume-io-latency` requires SSM/EC2 permissions. Ensure `aws_iam_role.fis_experiment_role` has the necessary permissions (e.g., `ec2:Describe*`, `ec2:AttachVolume`, `ec2:DetachVolume`, `ssm:SendCommand`, `iam:PassRole`). For quick testing, attach managed policies `AmazonEC2FullAccess` and `AmazonSSMFullAccess` (then restrict as needed). |

## üèóÔ∏è Exemples de commandes / Example Commands

| üá´üá∑ Fran√ßais                                                                                                                                                                                                                                                                                                                        | üá¨üáß English                                                                                                                                                                                                                                                                                                        |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| # Initialiser et planifier<br>`terraform init`<br>`terraform plan -var="region=eu-west-1"`<br><br> # Appliquer<br>`terraform apply -var="region=eu-west-1"`<br><br># D√©ployer uniquement dashboard et alarmes<br>`terraform apply -target=aws_cloudwatch_dashboard.fis_dashboard -target=aws_cloudwatch_metric_alarm.alb_5xx_alarm` | # Initialize and plan<br>`terraform init`<br>`terraform plan -var="region=eu-west-1"`<br><br># Apply<br>`terraform apply -var="region=eu-west-1"`<br><br># Deploy dashboard and alarms only<br>`terraform apply -target=aws_cloudwatch_dashboard.fis_dashboard -target=aws_cloudwatch_metric_alarm.alb_5xx_alarm` |


## üõ†Ô∏è D√©pannage rapide / Quick Troubleshooting

| üá´üá∑ Fran√ßais                                                                                                                                                                                                                                                                                                                                                                                                | üá¨üáß English                                                                                                                                                                                                                                                                                                                                                                     |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| - **Erreur "Missing resource instance key"** : se produit lorsque l‚Äôon tente d‚Äôacc√©der √† une ressource cr√©√©e avec `for_each` sans index. Utilisez `aws_cloudwatch_metric_alarm.name[key]` ou g√©n√©rez dynamiquement les `stop_condition` (cf. `fis.tf`).<br>- **Erreur FIS `AuthorizationFailure`** pendant une action (ex. `volume-io-latency`) : attachez aux IAM role les permissions SSM/EC2 n√©cessaires. | - **Error "Missing resource instance key"**: occurs when trying to access a resource created with `for_each` without an index. Use `aws_cloudwatch_metric_alarm.name[key]` or dynamically generate `stop_condition` (see `fis.tf`).<br>- **FIS Error `AuthorizationFailure`** during an action (e.g., `volume-io-latency`): attach required SSM/EC2 permissions to the IAM role. |


## üíª Commandes destructives / Useful Destructive Commands

| üá´üá∑ Fran√ßais                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | üá¨üáß English                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| # Forcer suppression d‚Äôun volume EBS (perte de donn√©es)<br>`aws ec2 detach-volume --volume-id vol-01234567890 --force --region eu-west-1`<br>`aws ec2 wait volume-available --volume-ids vol-01234567890 --region eu-west-1`<br>`aws ec2 delete-volume --volume-id vol-01234567890 --region eu-west-1`<br><br># Supprimer un secret (Secrets Manager)<br>`aws secretsmanager delete-secret --secret-id <nom-ou-arn> --force-delete-without-recovery --region eu-west-1` | # Force delete an EBS volume (data loss)<br>`aws ec2 detach-volume --volume-id vol-01234567890 --force --region eu-west-1`<br>`aws ec2 wait volume-available --volume-ids vol-01234567890 --region eu-west-1`<br>`aws ec2 delete-volume --volume-id vol-01234567890 --region eu-west-1`<br><br># Delete a secret immediately (Secrets Manager)<br>`aws secretsmanager delete-secret --secret-id <name-or-arn> --force-delete-without-recovery --region eu-west-1` |


## ‚úÖ Bonnes pratiques / Best Practices

| üá´üá∑ Fran√ßais                                                                                                                                                                                                                         | üá¨üáß English                                                                                                                                                                                                  |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| - Restreindre les permissions IAM du r√¥le FIS √† un policy minimal pour production.<br>- Tester d‚Äôabord sur un compte ou environnement non critique.<br>- V√©rifier que les tags `Service=web` existent bien sur vos volumes/instances. | - Restrict IAM permissions of the FIS role to a minimal policy for production.<br>- Test first on a non-critical account or environment.<br>- Ensure that `Service=web` tags exist on your volumes/instances. |


## üë§ Auteurs / Authors

| üá´üá∑ Fran√ßais                                                                                                                                                                                                                                                                                      | üá¨üáß English                                                                                                                                                                                                                                                                                |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| - Benjamin TOULOT-VERDIER ‚Äî Devoteam A Cloud<br>  - Soci√©t√© : Devoteam A Cloud<br>  - Site : [https://www.devoteam.com](https://www.devoteam.com)<br>  - Pour toute question ou contribution : ouvrez une issue dans ce d√©p√¥t ou contactez l‚Äôauteur via les canaux internes de votre organisation. | - Benjamin TOULOT-VERDIER ‚Äî Devoteam A Cloud<br>  - Company: Devoteam A Cloud<br>  - Website: [https://www.devoteam.com](https://www.devoteam.com)<br>  - For questions or contributions: open an issue in this repository or contact the author via your organization‚Äôs internal channels. |


## üîó Liens utiles / Useful Links

- Terraform resource (AWS FIS experiment template): [https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/fis_experiment_template](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/fis_experiment_template)
- AWS Fault Injection Service (FIS) ‚Äî user guide: [https://docs.aws.amazon.com/fis/latest/userguide/what-is-fis.html](https://docs.aws.amazon.com/fis/latest/userguide/what-is-fis.html)
- CloudWatch Metric Alarm (docs): [https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/AlarmThatSendsEmail.html](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/AlarmThatSendsEmail.html) |
